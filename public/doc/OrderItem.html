<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: OrderItem
  
    &mdash; Documentation by YARD 0.7.3
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (O)</a> &raquo; 
    
    
    <span class="title">OrderItem</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: OrderItem
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">OrderItem</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/models/order_item.rb</dd>
  
</dl>
<div class="clear"></div>



  


  

  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#order_items_in_cart-class_method" title="order_items_in_cart (class method)">+ (OrderItem) <strong>order_items_in_cart</strong>(order_id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
called in checkout process.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#adjusted_price-instance_method" title="#adjusted_price (instance method)">- (Float) <strong>adjusted_price</strong>(coupon = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
this is the price after coupons and anything before calculating the price +
tax.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#amount_of_charge_is_vat-instance_method" title="#amount_of_charge_is_vat (instance method)">- (Float) <strong>amount_of_charge_is_vat</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
the VAT charge on an item.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#amount_of_charge_without_vat-instance_method" title="#amount_of_charge_without_vat (instance method)">- (Float) <strong>amount_of_charge_without_vat</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
the amount of an item if there were zero VAT.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_order-instance_method" title="#calculate_order (instance method)">- (none) <strong>calculate_order</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
forces the order to be re-calculated.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_total-instance_method" title="#calculate_total (instance method)">- (Float) <strong>calculate_total</strong>(coupon = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
this is the price after coupons and taxes.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#item_total-instance_method" title="#item_total (instance method)">- (Float) <strong>item_total</strong>(coupon = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
this is the price after coupons and taxes.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ready_to_calculate%3F-instance_method" title="#ready_to_calculate? (instance method)">- (Boolean) <strong>ready_to_calculate?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
determines if the order item has all the attributes set and thus you can
now determine the final total.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_beginning_values-instance_method" title="#set_beginning_values (instance method)">- (Object) <strong>set_beginning_values</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_order_calculated_at_to_nil-instance_method" title="#set_order_calculated_at_to_nil (instance method)">- (none) <strong>set_order_calculated_at_to_nil</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
if something changes to the order item and you dont want to recalculate.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ship_category_id-instance_method" title="#ship_category_id (instance method)">- (Object) <strong>ship_category_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shipped%3F-instance_method" title="#shipped? (instance method)">- (Boolean) <strong>shipped?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
if the order item has been shipped it will return true.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shipping_method-instance_method" title="#shipping_method (instance method)">- (ShippingMethod) <strong>shipping_method</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
shipping method for the order item.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shipping_method_id-instance_method" title="#shipping_method_id (instance method)">- (Integer) <strong>shipping_method_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
shipping method id for the order item (use to reduce SQL calls).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shipping_rate_options-instance_method" title="#shipping_rate_options (instance method)">- (Object) <strong>shipping_rate_options</strong>(total_charge) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tax_charge-instance_method" title="#tax_charge (instance method)">- (Float) <strong>tax_charge</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
the tax charge on an item.
</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="order_items_in_cart-class_method">
  
    + (<tt><span class='object_link'><a href="" title="OrderItem (class)">OrderItem</a></span></tt>) <strong>order_items_in_cart</strong>(order_id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
called in checkout process. will give you the &#8216;quantity&#8217;,
&#8216;sum of all the prices&#8217; and &#8216;sum of all the totals&#8217;
</p>
<pre class="code">
 it is better to do the math in SQL than ruby</pre>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>order.id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="OrderItem (class)">OrderItem</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Object has addional attributes of [sum_price, sum_total,
shipping_category_id, and quantity]
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


69
70
71
72
73
74
75
76
77</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 69</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id order_items_in_cart'>order_items_in_cart</span><span class='lparen'>(</span><span class='id order_id'>order_id</span><span class='rparen'>)</span>
  <span class='id find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span> <span class='symbol'>:joins</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:variant</span> <span class='op'>=&gt;</span> <span class='symbol'>:product</span> <span class='rbrace'>}</span><span class='comma'>,</span>
             <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:order_items</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:order_id</span> <span class='op'>=&gt;</span> <span class='id order_id'>order_id</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='comma'>,</span>
             <span class='symbol'>:select</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>order_items.*, count(*) as quantity,
                                        products.shipping_category_id as shipping_category_id,
                                        SUM(order_items.price) as sum_price,
                                        SUM(order_items.total) as sum_total</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
             <span class='symbol'>:group</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>order_items.variant_id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="adjusted_price-instance_method">
  
    - (<tt>Float</tt>) <strong>adjusted_price</strong>(coupon = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
this is the price after coupons and anything before calculating the price +
tax
</p>
<pre class="code">
 in the future coupons and discounts could change this value</pre>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
this is the price that the tax will be applied to.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118
119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 115</span>

<span class='kw'>def</span> <span class='id adjusted_price'>adjusted_price</span><span class='lparen'>(</span><span class='id coupon'>coupon</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'>## coupon credit is calculated at the order level but because taxes we need to apply it now
</span>  <span class='comment'># =&gt; this calculation will be complete in the version of Hadean
</span>  <span class='id coupon_credit'>coupon_credit</span> <span class='op'>=</span> <span class='id coupon'>coupon</span> <span class='op'>?</span> <span class='id coupon'>coupon</span><span class='period'>.</span><span class='id value'>value</span><span class='lparen'>(</span><span class='id variant'>variant</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='float'>0.0</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id price'>price</span> <span class='op'>-</span> <span class='id coupon_credit'>coupon_credit</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="amount_of_charge_is_vat-instance_method">
  
    - (<tt>Float</tt>) <strong>amount_of_charge_is_vat</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
the VAT charge on an item
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
tax charge on the item.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 159</span>

<span class='kw'>def</span> <span class='id amount_of_charge_is_vat'>amount_of_charge_is_vat</span>
  <span class='id vat_percentage'>vat_percentage</span> <span class='op'>=</span> <span class='id tax_rate'>tax_rate</span><span class='period'>.</span><span class='id try'>try</span><span class='lparen'>(</span><span class='symbol'>:vat_percentage</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id tax_rate'>tax_rate</span><span class='period'>.</span><span class='id vat_percentage'>vat_percentage</span> <span class='op'>:</span> <span class='float'>0.0</span>
  <span class='lparen'>(</span><span class='id adjusted_price'>adjusted_price</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id vat_percentage'>vat_percentage</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='float'>100.0</span> <span class='op'>+</span> <span class='id vat_percentage'>vat_percentage</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id round_at'>round_at</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="amount_of_charge_without_vat-instance_method">
  
    - (<tt>Float</tt>) <strong>amount_of_charge_without_vat</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
the amount of an item if there were zero VAT
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
tax charge on the item.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


168
169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 168</span>

<span class='kw'>def</span> <span class='id amount_of_charge_without_vat'>amount_of_charge_without_vat</span>
  <span class='id vat_percentage'>vat_percentage</span> <span class='op'>=</span> <span class='id tax_rate'>tax_rate</span><span class='period'>.</span><span class='id try'>try</span><span class='lparen'>(</span><span class='symbol'>:vat_percentage</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id tax_rate'>tax_rate</span><span class='period'>.</span><span class='id vat_percentage'>vat_percentage</span> <span class='op'>:</span> <span class='float'>0.0</span>
  <span class='lparen'>(</span><span class='float'>100.0</span> <span class='op'>*</span> <span class='id adjusted_price'>adjusted_price</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='float'>100.0</span> <span class='op'>+</span> <span class='id vat_percentage'>vat_percentage</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id round_at'>round_at</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="calculate_order-instance_method">
  
    - (<tt>none</tt>) <strong>calculate_order</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
forces the order to be re-calculated.  If the order item has changed then
the order totals need to be adjusted
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 83</span>

<span class='kw'>def</span> <span class='id calculate_order'>calculate_order</span>
  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id ready_to_calculate?'>ready_to_calculate?</span> <span class='op'>&amp;&amp;</span>
      <span class='lparen'>(</span><span class='id shipping_rate_id'>shipping_rate_id</span> <span class='op'>!=</span> <span class='ivar'>@beginning_shipping_rate_id</span> <span class='op'>||</span> <span class='id tax_rate_id'>tax_rate_id</span> <span class='op'>!=</span> <span class='ivar'>@beginning_tax_rate_id</span><span class='rparen'>)</span>
    <span class='id set_beginning_values'>set_beginning_values</span>
    <span class='id order'>order</span><span class='period'>.</span><span class='id calculate_totals'>calculate_totals</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="calculate_total-instance_method">
  
    - (<tt>Float</tt>) <strong>calculate_total</strong>(coupon = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
this is the price after coupons and taxes
</p>
<pre class="code">
  * this method does not save it just sets the value of total.
  * Thus allowing you to save the whole order with one opperation</pre>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
this is the total of the item after taxes and coupons&#8230;
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 140</span>

<span class='kw'>def</span> <span class='id calculate_total'>calculate_total</span><span class='lparen'>(</span><span class='id coupon'>coupon</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># shipping charges are calculated in order.rb
</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id total'>total</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id adjusted_price'>adjusted_price</span><span class='lparen'>(</span><span class='id coupon'>coupon</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id tax_charge'>tax_charge</span><span class='rparen'>)</span><span class='period'>.</span><span class='id round_at'>round_at</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="item_total-instance_method">
  
    - (<tt>Float</tt>) <strong>item_total</strong>(coupon = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
this is the price after coupons and taxes
</p>
<pre class="code">
  * this return total if has not been calculated, otherwise calculates the total.</pre>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
this is the total of the item after taxes and coupons&#8230;
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 128</span>

<span class='kw'>def</span> <span class='id item_total'>item_total</span><span class='lparen'>(</span><span class='id coupon'>coupon</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># shipping charges are calculated in order.rb
</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id total'>total</span> <span class='op'>||=</span> <span class='id calculate_total'>calculate_total</span><span class='lparen'>(</span><span class='id coupon'>coupon</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ready_to_calculate?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>ready_to_calculate?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
determines if the order item has all the attributes set and thus you can
now determine the final total
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


106
107
108</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 106</span>

<span class='kw'>def</span> <span class='id ready_to_calculate?'>ready_to_calculate?</span>
  <span class='id shipping_rate_id'>shipping_rate_id</span> <span class='op'>&amp;&amp;</span> <span class='id tax_rate_id'>tax_rate_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="set_beginning_values-instance_method">
  
    - (<tt>Object</tt>) <strong>set_beginning_values</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 17</span>

<span class='kw'>def</span> <span class='id set_beginning_values'>set_beginning_values</span>
  <span class='ivar'>@beginning_tax_rate_id</span>      <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id tax_rate_id'>tax_rate_id</span>      <span class='kw'>rescue</span> <span class='ivar'>@beginning_tax_rate_id</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='comment'># this stores the initial value of the tax_rate
</span>  <span class='ivar'>@beginning_shipping_rate_id</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id shipping_rate_id'>shipping_rate_id</span> <span class='kw'>rescue</span> <span class='ivar'>@beginning_shipping_rate_id</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='comment'># this stores the initial value of the tax_rate
</span>  <span class='ivar'>@beginning_total</span>            <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id total'>total</span>            <span class='kw'>rescue</span> <span class='ivar'>@beginning_total</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='comment'># this stores the initial value of the total
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="set_order_calculated_at_to_nil-instance_method">
  
    - (<tt>none</tt>) <strong>set_order_calculated_at_to_nil</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
if something changes to the order item and you dont want to recalculate
</p>
<pre class="code">
  (maybe because you are chnging several more things) then
   this method will mark the calculated at to be nil and thus tell the order that
   it needs to calculate the total again</pre>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 98</span>

<span class='kw'>def</span> <span class='id set_order_calculated_at_to_nil'>set_order_calculated_at_to_nil</span>
  <span class='id order'>order</span><span class='period'>.</span><span class='id update_attribute'>update_attribute</span><span class='lparen'>(</span><span class='symbol'>:calculated_at</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ship_category_id-instance_method">
  
    - (<tt>Object</tt>) <strong>ship_category_id</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 54</span>

<span class='kw'>def</span> <span class='id ship_category_id'>ship_category_id</span>
  <span class='id variant'>variant</span><span class='period'>.</span><span class='id product'>product</span><span class='period'>.</span><span class='id shipping_category_id'>shipping_category_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="shipped?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>shipped?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
if the order item has been shipped it will return true
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 33</span>

<span class='kw'>def</span> <span class='id shipped?'>shipped?</span>
  <span class='id shipment_id?'>shipment_id?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="shipping_method-instance_method">
  
    - (<tt><span class='object_link'><a href="ShippingMethod.html" title="ShippingMethod (class)">ShippingMethod</a></span></tt>) <strong>shipping_method</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
shipping method for the order item
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ShippingMethod.html" title="ShippingMethod (class)">ShippingMethod</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 41</span>

<span class='kw'>def</span> <span class='id shipping_method'>shipping_method</span>
  <span class='id shipping_rate'>shipping_rate</span><span class='period'>.</span><span class='id shipping_method'>shipping_method</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="shipping_method_id-instance_method">
  
    - (<tt>Integer</tt>) <strong>shipping_method_id</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
shipping method id for the order item (use to reduce SQL calls)
</p>
<pre class="code">
  <span class='id refer'>refer</span> <span class='id to'>to</span> <span class='const'>ShippingMethod</span> <span class='const'>ID</span> <span class='id constants'>constants</span> <span class='id to'>to</span> <span class='id determine'>determine</span> <span class='id what'>what</span> <span class='id shipping'>shipping</span> <span class='id method'>method</span> <span class='id is'>is</span> <span class='id called'>called</span></pre>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
ShippingMethod id
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 50</span>

<span class='kw'>def</span> <span class='id shipping_method_id'>shipping_method_id</span>
  <span class='id shipping_rate'>shipping_rate</span><span class='period'>.</span><span class='id shipping_method_id'>shipping_method_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="shipping_rate_options-instance_method">
  
    - (<tt>Object</tt>) <strong>shipping_rate_options</strong>(total_charge) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 58</span>

<span class='kw'>def</span> <span class='id shipping_rate_options'>shipping_rate_options</span><span class='lparen'>(</span><span class='id total_charge'>total_charge</span><span class='rparen'>)</span>
  <span class='const'>ShippingRate</span><span class='period'>.</span><span class='id joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:shipping_method</span><span class='rparen'>)</span><span class='period'>.</span><span class='id where'>where</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>shipping_rates.shipping_category_id = ?
                      AND shipping_methods.shipping_zone_id = ?
                      AND shipping_rates.minimum_charge &lt;= ?</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id ship_category_id'>ship_category_id</span><span class='comma'>,</span> <span class='id order'>order</span><span class='period'>.</span><span class='id ship_address'>ship_address</span><span class='period'>.</span><span class='id state'>state</span><span class='period'>.</span><span class='id shipping_zone_id'>shipping_zone_id</span><span class='comma'>,</span> <span class='id total_charge'>total_charge</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id all'>all</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="tax_charge-instance_method">
  
    - (<tt>Float</tt>) <strong>tax_charge</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
the tax charge on an item
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
tax charge on the item.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 150</span>

<span class='kw'>def</span> <span class='id tax_charge'>tax_charge</span>
  <span class='id tax_percentage'>tax_percentage</span> <span class='op'>=</span> <span class='id tax_rate'>tax_rate</span><span class='period'>.</span><span class='id try'>try</span><span class='lparen'>(</span><span class='symbol'>:tax_percentage</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id tax_rate'>tax_rate</span><span class='period'>.</span><span class='id tax_percentage'>tax_percentage</span> <span class='op'>:</span> <span class='float'>0.0</span>
  <span class='id adjusted_price'>adjusted_price</span> <span class='op'>*</span> <span class='id tax_percentage'>tax_percentage</span> <span class='op'>/</span> <span class='float'>100.0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Nov 29 10:08:55 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.3 (ruby-1.9.2).
</div>

  </body>
</html>