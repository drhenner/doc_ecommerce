<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: OrderItem
  
    &mdash; Documentation by YARD 0.8.3
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (O)</a> &raquo;
    
    
    <span class="title">OrderItem</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: OrderItem
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">OrderItem</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/models/order_item.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<h2>Schema Information</h2>

<p>Table name: order_items</p>

<pre class="code ruby"><code>id               :integer(4)      not null, primary key
price            :decimal(8, 2)
total            :decimal(8, 2)
order_id         :integer(4)      not null
variant_id       :integer(4)      not null
state            :string(255)     not null
tax_rate_id      :integer(4)
shipping_rate_id :integer(4)
shipment_id      :integer(4)
created_at       :datetime
updated_at       :datetime</code></pre>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#order_items_in_cart-class_method" title="order_items_in_cart (class method)">+ (OrderItem) <strong>order_items_in_cart</strong>(order_id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>called in checkout process.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#adjusted_price-instance_method" title="#adjusted_price (instance method)">- (Float) <strong>adjusted_price</strong>(coupon = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>this is the price after coupons and anything before calculating the price +
tax.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#amount_of_charge_is_vat-instance_method" title="#amount_of_charge_is_vat (instance method)">- (Float) <strong>amount_of_charge_is_vat</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>the VAT charge on an item.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#amount_of_charge_without_vat-instance_method" title="#amount_of_charge_without_vat (instance method)">- (Float) <strong>amount_of_charge_without_vat</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>the amount of an item if there were zero VAT.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_order-instance_method" title="#calculate_order (instance method)">- (none) <strong>calculate_order</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>forces the order to be re-calculated.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_total-instance_method" title="#calculate_total (instance method)">- (Float) <strong>calculate_total</strong>(coupon = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>this is the price after coupons, deals and sales.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#item_total-instance_method" title="#item_total (instance method)">- (Float) <strong>item_total</strong>(coupon = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>this is the price after coupons and taxes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#product_type-instance_method" title="#product_type (instance method)">- (Object) <strong>product_type</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#product_type_ids-instance_method" title="#product_type_ids (instance method)">- (Object) <strong>product_type_ids</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ready_to_calculate%3F-instance_method" title="#ready_to_calculate? (instance method)">- (Boolean) <strong>ready_to_calculate?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>determines if the order item has all the attributes set and thus you can
now determine the final total.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sale_at-instance_method" title="#sale_at (instance method)">- (Object) <strong>sale_at</strong>(at = Time.zone.now) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sale_price-instance_method" title="#sale_price (instance method)">- (Object) <strong>sale_price</strong>(at) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_beginning_values-instance_method" title="#set_beginning_values (instance method)">- (Object) <strong>set_beginning_values</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_order_calculated_at_to_nil-instance_method" title="#set_order_calculated_at_to_nil (instance method)">- (none) <strong>set_order_calculated_at_to_nil</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>if something changes to the order item and you dont want to recalculate.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ship_category_id-instance_method" title="#ship_category_id (instance method)">- (Object) <strong>ship_category_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shipped%3F-instance_method" title="#shipped? (instance method)">- (Boolean) <strong>shipped?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>if the order item has been shipped it will return true.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shipping_method-instance_method" title="#shipping_method (instance method)">- (ShippingMethod) <strong>shipping_method</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>shipping method for the order item.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shipping_method_id-instance_method" title="#shipping_method_id (instance method)">- (Integer) <strong>shipping_method_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>shipping method id for the order item (use to reduce SQL calls).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shipping_rate_options-instance_method" title="#shipping_rate_options (instance method)">- (Object) <strong>shipping_rate_options</strong>(total_charge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tax_charge-instance_method" title="#tax_charge (instance method)">- (Float) <strong>tax_charge</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>the tax charge on an item.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="order_items_in_cart-class_method">
  
    + (<tt><span class='object_link'><a href="" title="OrderItem (class)">OrderItem</a></span></tt>) <strong>order_items_in_cart</strong>(order_id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>called in checkout process. will give you the 'quantity', 'sum of all the
prices' and 'sum of all the totals'</p>

<pre class="code ruby"><code>it is better to do the math in SQL than ruby</code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>order.id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="OrderItem (class)">OrderItem</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Object has addional attributes of [sum_price, sum_total,
shipping_category_id, and quantity]</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 100</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_order_items_in_cart'>order_items_in_cart</span><span class='lparen'>(</span><span class='id identifier rubyid_order_id'>order_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span> <span class='symbol'>:joins</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:variant</span> <span class='op'>=&gt;</span> <span class='symbol'>:product</span> <span class='rbrace'>}</span><span class='comma'>,</span>
             <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:order_items</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:order_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_order_id'>order_id</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='comma'>,</span>
             <span class='symbol'>:select</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>order_items.id, order_items.order_id, order_items.shipping_rate_id, order_items.state, order_items.tax_rate_id, order_items.price, order_items.total, order_items.variant_id,
                         products.shipping_category_id,
                                        count(*) as quantity,
                                        products.shipping_category_id as shipping_category_id,
                                        SUM(order_items.price) as sum_price,
                                        SUM(order_items.total) as sum_total</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
             <span class='symbol'>:group</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>order_items.id,
                        products.shipping_category_id,
                        order_items.order_id,
                        order_items.shipping_rate_id,
                        order_items.state,
                        order_items.tax_rate_id,
                        order_items.price,
                        order_items.total, order_items.variant_id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="adjusted_price-instance_method">
  
    - (<tt>Float</tt>) <strong>adjusted_price</strong>(coupon = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>this is the price after coupons and anything before calculating the price +
tax</p>

<pre class="code ruby"><code>in the future coupons and discounts could change this value</code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>this is the price that the tax will be applied to.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158
159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 156</span>

<span class='kw'>def</span> <span class='id identifier rubyid_adjusted_price'>adjusted_price</span><span class='lparen'>(</span><span class='id identifier rubyid_coupon'>coupon</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'>## coupon credit is calculated at the order level but because taxes we need to apply it now
</span>  <span class='id identifier rubyid_coupon_credit'>coupon_credit</span> <span class='op'>=</span> <span class='id identifier rubyid_coupon'>coupon</span> <span class='op'>?</span> <span class='id identifier rubyid_coupon'>coupon</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_sale_price'>sale_price</span><span class='lparen'>(</span><span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_transaction_time'>transaction_time</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='float'>0.0</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_price'>price</span> <span class='op'>-</span> <span class='id identifier rubyid_coupon_credit'>coupon_credit</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="amount_of_charge_is_vat-instance_method">
  
    - (<tt>Float</tt>) <strong>amount_of_charge_is_vat</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>the VAT charge on an item</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>tax charge on the item.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


208
209
210
211</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 208</span>

<span class='kw'>def</span> <span class='id identifier rubyid_amount_of_charge_is_vat'>amount_of_charge_is_vat</span>
  <span class='id identifier rubyid_vat_percentage'>vat_percentage</span> <span class='op'>=</span> <span class='id identifier rubyid_tax_rate'>tax_rate</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:vat_percentage</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_tax_rate'>tax_rate</span><span class='period'>.</span><span class='id identifier rubyid_vat_percentage'>vat_percentage</span> <span class='op'>:</span> <span class='float'>0.0</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_adjusted_price'>adjusted_price</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_vat_percentage'>vat_percentage</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='float'>100.0</span> <span class='op'>+</span> <span class='id identifier rubyid_vat_percentage'>vat_percentage</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round_at'>round_at</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="amount_of_charge_without_vat-instance_method">
  
    - (<tt>Float</tt>) <strong>amount_of_charge_without_vat</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>the amount of an item if there were zero VAT</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>tax charge on the item.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


217
218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 217</span>

<span class='kw'>def</span> <span class='id identifier rubyid_amount_of_charge_without_vat'>amount_of_charge_without_vat</span>
  <span class='id identifier rubyid_vat_percentage'>vat_percentage</span> <span class='op'>=</span> <span class='id identifier rubyid_tax_rate'>tax_rate</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:vat_percentage</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_tax_rate'>tax_rate</span><span class='period'>.</span><span class='id identifier rubyid_vat_percentage'>vat_percentage</span> <span class='op'>:</span> <span class='float'>0.0</span>
  <span class='lparen'>(</span><span class='float'>100.0</span> <span class='op'>*</span> <span class='id identifier rubyid_adjusted_price'>adjusted_price</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='float'>100.0</span> <span class='op'>+</span> <span class='id identifier rubyid_vat_percentage'>vat_percentage</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round_at'>round_at</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate_order-instance_method">
  
    - (<tt>none</tt>) <strong>calculate_order</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>forces the order to be re-calculated.  If the order item has changed then
the order totals need to be adjusted</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_calculate_order'>calculate_order</span>
  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ready_to_calculate?'>ready_to_calculate?</span> <span class='op'>&amp;&amp;</span>
      <span class='lparen'>(</span><span class='id identifier rubyid_shipping_rate_id'>shipping_rate_id</span> <span class='op'>!=</span> <span class='ivar'>@beginning_shipping_rate_id</span> <span class='op'>||</span> <span class='id identifier rubyid_tax_rate_id'>tax_rate_id</span> <span class='op'>!=</span> <span class='ivar'>@beginning_tax_rate_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_set_beginning_values'>set_beginning_values</span>
    <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_calculate_totals'>calculate_totals</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate_total-instance_method">
  
    - (<tt>Float</tt>) <strong>calculate_total</strong>(coupon = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>this is the price after coupons, deals and sales</p>

<pre class="code ruby"><code>* this method does not save it just sets the value of total.
* Thus allowing you to save the whole order with one opperation</code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>this is the total of the item after coupons/deals/sales...</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


189
190
191
192
193</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 189</span>

<span class='kw'>def</span> <span class='id identifier rubyid_calculate_total'>calculate_total</span><span class='lparen'>(</span><span class='id identifier rubyid_coupon'>coupon</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># shipping charges are calculated in order.rb
</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_adjusted_price'>adjusted_price</span><span class='lparen'>(</span><span class='id identifier rubyid_coupon'>coupon</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round_at'>round_at</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="item_total-instance_method">
  
    - (<tt>Float</tt>) <strong>item_total</strong>(coupon = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>this is the price after coupons and taxes</p>

<pre class="code ruby"><code>* this return total if has not been calculated, otherwise calculates the total.</code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>this is the total of the item after taxes and coupons...</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


177
178
179
180
181</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 177</span>

<span class='kw'>def</span> <span class='id identifier rubyid_item_total'>item_total</span><span class='lparen'>(</span><span class='id identifier rubyid_coupon'>coupon</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># shipping charges are calculated in order.rb
</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_total'>total</span> <span class='op'>||=</span> <span class='id identifier rubyid_calculate_total'>calculate_total</span><span class='lparen'>(</span><span class='id identifier rubyid_coupon'>coupon</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="product_type-instance_method">
  
    - (<tt>Object</tt>) <strong>product_type</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 52</span>

<span class='kw'>def</span> <span class='id identifier rubyid_product_type'>product_type</span>
  <span class='id identifier rubyid_variant'>variant</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_product_type'>product_type</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="product_type_ids-instance_method">
  
    - (<tt>Object</tt>) <strong>product_type_ids</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 56</span>

<span class='kw'>def</span> <span class='id identifier rubyid_product_type_ids'>product_type_ids</span>
  <span class='id identifier rubyid_product_type'>product_type</span><span class='period'>.</span><span class='id identifier rubyid_self_and_ancestors'>self_and_ancestors</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ready_to_calculate?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>ready_to_calculate?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>determines if the order item has all the attributes set and thus you can
now determine the final total</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 146</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ready_to_calculate?'>ready_to_calculate?</span>
  <span class='id identifier rubyid_shipping_rate_id'>shipping_rate_id</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_tax_rate_id'>tax_rate_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sale_at-instance_method">
  
    - (<tt>Object</tt>) <strong>sale_at</strong>(at = Time.zone.now) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


168
169
170</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 168</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sale_at'>sale_at</span><span class='lparen'>(</span><span class='id identifier rubyid_at'>at</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>
  <span class='const'>Sale</span><span class='period'>.</span><span class='id identifier rubyid_for'>for</span><span class='lparen'>(</span><span class='id identifier rubyid_variant'>variant</span><span class='period'>.</span><span class='id identifier rubyid_product_id'>product_id</span><span class='comma'>,</span> <span class='id identifier rubyid_at'>at</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sale_price-instance_method">
  
    - (<tt>Object</tt>) <strong>sale_price</strong>(at) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


163
164
165
166</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 163</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sale_price'>sale_price</span><span class='lparen'>(</span><span class='id identifier rubyid_at'>at</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sale'>sale</span> <span class='op'>=</span> <span class='id identifier rubyid_sale_at'>sale_at</span><span class='lparen'>(</span><span class='id identifier rubyid_at'>at</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sale'>sale</span> <span class='op'>?</span> <span class='lparen'>(</span> <span class='lparen'>(</span><span class='float'>1.0</span> <span class='op'>-</span> <span class='id identifier rubyid_sale'>sale</span><span class='period'>.</span><span class='id identifier rubyid_percent_off'>percent_off</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_price'>price</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round_at'>round_at</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_price'>price</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_beginning_values-instance_method">
  
    - (<tt>Object</tt>) <strong>set_beginning_values</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 34</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_beginning_values'>set_beginning_values</span>
  <span class='ivar'>@beginning_tax_rate_id</span>      <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_tax_rate_id'>tax_rate_id</span>      <span class='kw'>rescue</span> <span class='ivar'>@beginning_tax_rate_id</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='comment'># this stores the initial value of the tax_rate
</span>  <span class='ivar'>@beginning_shipping_rate_id</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_shipping_rate_id'>shipping_rate_id</span> <span class='kw'>rescue</span> <span class='ivar'>@beginning_shipping_rate_id</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='comment'># this stores the initial value of the tax_rate
</span>  <span class='ivar'>@beginning_total</span>            <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_total'>total</span>            <span class='kw'>rescue</span> <span class='ivar'>@beginning_total</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='comment'># this stores the initial value of the total
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_order_calculated_at_to_nil-instance_method">
  
    - (<tt>none</tt>) <strong>set_order_calculated_at_to_nil</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>if something changes to the order item and you dont want to recalculate</p>

<pre class="code ruby"><code>(maybe because you are chnging several more things) then
 this method will mark the calculated at to be nil and thus tell the order that
 it needs to calculate the total again</code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 138</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_order_calculated_at_to_nil'>set_order_calculated_at_to_nil</span>
  <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_update_attribute'>update_attribute</span><span class='lparen'>(</span><span class='symbol'>:calculated_at</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ship_category_id-instance_method">
  
    - (<tt>Object</tt>) <strong>ship_category_id</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 85</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ship_category_id'>ship_category_id</span>
  <span class='id identifier rubyid_variant'>variant</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_shipping_category_id'>shipping_category_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shipped?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>shipped?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>if the order item has been shipped it will return true</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 64</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shipped?'>shipped?</span>
  <span class='id identifier rubyid_shipment_id?'>shipment_id?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shipping_method-instance_method">
  
    - (<tt><span class='object_link'><a href="ShippingMethod.html" title="ShippingMethod (class)">ShippingMethod</a></span></tt>) <strong>shipping_method</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>shipping method for the order item</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ShippingMethod.html" title="ShippingMethod (class)">ShippingMethod</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 72</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shipping_method'>shipping_method</span>
  <span class='id identifier rubyid_shipping_rate'>shipping_rate</span><span class='period'>.</span><span class='id identifier rubyid_shipping_method'>shipping_method</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shipping_method_id-instance_method">
  
    - (<tt>Integer</tt>) <strong>shipping_method_id</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>shipping method id for the order item (use to reduce SQL calls)</p>

<pre class="code ruby"><code><span class='id identifier rubyid_refer'>refer</span> <span class='id identifier rubyid_to'>to</span> <span class='const'>ShippingMethod</span> <span class='const'>ID</span> <span class='id identifier rubyid_constants'>constants</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_determine'>determine</span> <span class='id identifier rubyid_what'>what</span> <span class='id identifier rubyid_shipping'>shipping</span> <span class='id identifier rubyid_method'>method</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_called'>called</span></code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ShippingMethod id</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 81</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shipping_method_id'>shipping_method_id</span>
  <span class='id identifier rubyid_shipping_rate'>shipping_rate</span><span class='period'>.</span><span class='id identifier rubyid_shipping_method_id'>shipping_method_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shipping_rate_options-instance_method">
  
    - (<tt>Object</tt>) <strong>shipping_rate_options</strong>(total_charge) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


89
90
91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 89</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shipping_rate_options'>shipping_rate_options</span><span class='lparen'>(</span><span class='id identifier rubyid_total_charge'>total_charge</span><span class='rparen'>)</span>
  <span class='const'>ShippingRate</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:shipping_method</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>shipping_rates.shipping_category_id = ?
                      AND shipping_methods.shipping_zone_id = ?
                      AND shipping_rates.minimum_charge &lt;= ?</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ship_category_id'>ship_category_id</span><span class='comma'>,</span> <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_ship_address'>ship_address</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_shipping_zone_id'>shipping_zone_id</span><span class='comma'>,</span> <span class='id identifier rubyid_total_charge'>total_charge</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tax_charge-instance_method">
  
    - (<tt>Float</tt>) <strong>tax_charge</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>the tax charge on an item</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt>none</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>tax charge on the item.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201
202</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/order_item.rb', line 199</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tax_charge'>tax_charge</span>
  <span class='id identifier rubyid_tax_percentage'>tax_percentage</span> <span class='op'>=</span> <span class='id identifier rubyid_tax_rate'>tax_rate</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:tax_percentage</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_tax_rate'>tax_rate</span><span class='period'>.</span><span class='id identifier rubyid_tax_percentage'>tax_percentage</span> <span class='op'>:</span> <span class='float'>0.0</span>
  <span class='id identifier rubyid_adjusted_price'>adjusted_price</span> <span class='op'>*</span> <span class='id identifier rubyid_tax_percentage'>tax_percentage</span> <span class='op'>/</span> <span class='float'>100.0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Jan 21 18:43:35 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.3 (ruby-1.9.3).
</div>

  </body>
</html>